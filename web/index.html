<!doctype html>
<html lang="ru" data-theme="light">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Institute Score Dashboard — рейтинг HW ИИИ ДПО 25-26</title>
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Fraunces:opsz,wght@9..144,600;700&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="/assets/styles.css"/>
  <script src="https://cdn.plot.ly/plotly-2.30.0.min.js"></script>
</head>
<body>

<div class="app">
  <aside class="panel panel-left" style="--delay: 0.1s;">
    <header class="panel-head">
      <div class="eyebrow">Institute Score</div>
      <h1 id="titleRange">Рейтинг HW</h1>
      <p class="sub">
        Интерфейс заточен на точечный разбор, сравнение и общий срез.
        Данные читаются напрямую из XLSX-файлов.
      </p>
      <div class="meta-row">
        <span id="metaStudents" class="pill">студентов: —</span>
        <span id="metaFiles" class="pill">файлов: —</span>
      </div>
    </header>

    <div class="panel-body">
      <div class="btn-row">
        <button id="btnTheme" class="btn ghost">Тема: светлая</button>
        <button id="btnRefresh" class="btn primary">Обновить XLSX</button>
      </div>
      <div class="btn-row">
        <button id="btnReset" class="btn">Сброс фильтров</button>
        <button id="btnExport" class="btn">Экспорт CSV</button>
      </div>

      <div class="field">
        <label>Поиск по ФИО</label>
        <input id="q" class="input" placeholder="Начните вводить фамилию..." autocomplete="off"/>
        <div id="suggest" class="suggest" style="display:none"></div>
        <div class="help">Нажмите Enter, чтобы выбрать первого найденного.</div>
      </div>

      <div class="field">
        <label>Статус</label>
        <div class="chips" id="chipsStatus">
          <div class="chip" data-key="хорошие показатели" data-active="true"><span class="dot good"></span>хорошие показатели</div>
          <div class="chip" data-key="средние показатели" data-active="true"><span class="dot mid"></span>средние показатели</div>
          <div class="chip" data-key="низкие показатели" data-active="true"><span class="dot bad"></span>низкие показатели</div>
        </div>
      </div>

      <div class="field">
        <label>Минимум зачтено</label>
        <input id="minAcc" class="slider" type="range" min="0" max="7" value="0"/>
        <div class="help"><span id="minAccLabel">0</span> из <span id="minAccTotal">7</span></div>
      </div>

      <details class="disclosure" id="advancedFilters">
        <summary>
          <span>Дополнительно</span>
          <span class="disclosure-hint">настройки графиков и ограничений</span>
        </summary>
        <div class="disclosure-body">
          <div class="field">
            <label>Топ-N</label>
            <select id="topN">
              <option value="0">Все</option>
              <option value="10">Топ-10</option>
              <option value="50">Топ-50</option>
              <option value="100">Топ-100</option>
              <option value="200">Топ-200</option>
            </select>
          </div>

          <div class="field">
            <label>Ось X: вариант ранга</label>
            <select id="rankMode">
              <option value="position">Позиция (1..N)</option>
              <option value="competition">Одинаковый зачет = общий ранг</option>
              <option value="dense">Ранг по уровням зачета</option>
            </select>
            <div class="help">Ранг меняет только ось X. Зачет остается по количеству принятых работ.</div>
          </div>

          <div class="field">
            <label>Окраска точек</label>
            <select id="colorMode">
              <option value="status" selected>По статусу</option>
              <option value="accepted">По числу зачетов</option>
            </select>
          </div>

          <div class="field">
            <label>Распределение</label>
            <select id="distMode">
              <option value="filtered">Текущая выборка</option>
              <option value="total">Весь набор</option>
            </select>
          </div>

          <div class="field">
            <label>Подсветка сравнения</label>
            <div class="btn-row">
              <button id="btnHighlight" class="btn">Подсветка: включена</button>
            </div>
          </div>
        </div>
      </details>

      <div class="footnote">
        Обновление из XLSX работает без сервера баз данных — просто перезапишите файлы и нажмите «Обновить».
      </div>
    </div>
  </aside>

  <main class="main" style="--delay: 0.2s;">
    <section class="kpi-grid">
      <div class="kpi">
        <div class="kpi-label">Всего студентов</div>
        <div id="kTotal" class="kpi-value">—</div>
        <div class="kpi-sub">в датасете</div>
      </div>
      <div class="kpi">
        <div class="kpi-label">В выборке</div>
        <div id="kFiltered" class="kpi-value">—</div>
        <div id="kFilteredSub" class="kpi-sub">после фильтров</div>
      </div>
      <div class="kpi">
        <div class="kpi-label">Средний зачет</div>
        <div id="kMean" class="kpi-value">—</div>
        <div class="kpi-sub">в текущей выборке</div>
      </div>
      <div class="kpi">
        <div class="kpi-label">Доля хороших показателей</div>
        <div id="kGoodShare" class="kpi-value">—</div>
        <div class="kpi-sub">в текущей выборке</div>
      </div>
    </section>

    <div id="banner" class="banner" role="status" aria-live="polite" style="display:none"></div>

    <section class="hw-summary" style="--delay: 0.21s;">
      <header class="hw-summary-head">
        <div>
          <div class="chart-title">Сводка по HW</div>
          <div class="chart-sub">Клик по “зачтено/не зачтено/нет данных” фильтрует рейтинг.</div>
        </div>
        <button id="hwFilterPill" class="pill pill-btn" type="button" style="display:none"></button>
      </header>
      <div id="hwCards" class="hw-cards"></div>
    </section>

    <section class="chart chart--table" style="--delay: 0.22s;">
      <header class="chart-head">
        <div>
          <div class="chart-title">Рейтинг</div>
          <div class="chart-sub">Клик по строке выбирает студента. Кнопка “+” добавляет/удаляет из сравнения.</div>
        </div>
        <div>
          <div id="chartMeta" class="chart-meta">обновлено: —</div>
          <div id="tableMeta" class="chart-meta">—</div>
        </div>
      </header>
      <div class="table-wrap">
        <table class="table" aria-label="Рейтинг студентов">
          <thead>
          <tr>
            <th class="col-rank">#</th>
            <th class="col-name">ФИО</th>
            <th class="col-acc">Зачтено</th>
            <th class="col-status">Статус</th>
            <th class="col-act" aria-label="Сравнение"></th>
          </tr>
          </thead>
          <tbody id="ratingTbody"></tbody>
        </table>
      </div>
    </section>

    <section class="chart chart--compare" style="--delay: 0.26s;">
      <header class="chart-head">
        <div>
          <div class="chart-title">Сравнение динамики</div>
          <div class="chart-sub">Кумулятивный зачет по <span id="chartRange">HW</span>. Добавляйте людей справа или через “+” в таблице.</div>
        </div>
      </header>
      <div id="plotCompare" class="plot plot--compare"></div>
    </section>

    <details class="insights" id="insights" style="--delay: 0.30s;">
      <summary>
        <div class="insights-summary">
          <div class="insights-title">Инсайты</div>
          <div class="insights-sub">Графики для точечного анализа (scatter + распределение).</div>
        </div>
        <div class="pill">открыть</div>
      </summary>
      <div class="insights-body">
        <section class="chart chart--big">
          <header class="chart-head">
            <div>
              <div class="chart-title">Распределение по рангу и зачету</div>
              <div class="chart-sub">Клик по точке открывает карточку студента.</div>
            </div>
          </header>
          <div id="plotScatter" class="plot"></div>
        </section>
        <section class="chart">
          <header class="chart-head">
            <div>
              <div class="chart-title">Срез по количеству зачетов</div>
              <div class="chart-sub">Распределение студентов по 0..N.</div>
            </div>
          </header>
          <div id="plotDist" class="plot"></div>
        </section>
      </div>
    </details>
  </main>

  <aside class="panel panel-right" style="--delay: 0.3s;">
    <header class="panel-head">
      <div class="eyebrow">Фокус</div>
      <h2>Карточка студента</h2>
      <div id="selPill" class="pill">ничего не выбрано</div>
    </header>
    <div class="panel-body">
      <div id="detail" class="detail-card">
        <div class="detail-empty">Выберите точку или имя, чтобы увидеть персональную карточку.</div>
      </div>

      <div class="divider"></div>

      <div class="compare-head">
        <div>
          <div class="compare-title">Сравнение</div>
          <div class="compare-sub">Добавьте несколько людей и сравните с общей кривой.</div>
        </div>
        <div class="compare-actions">
          <button id="btnAddCompare" class="btn primary" disabled>Добавить выбранного</button>
          <button id="btnClearCompare" class="btn">Очистить</button>
        </div>
      </div>

      <div class="field">
        <label>Добавить по имени</label>
        <input id="compareInput" class="input" placeholder="Фамилия или часть имени" autocomplete="off"/>
        <div id="compareSuggest" class="suggest" style="display:none"></div>
      </div>

      <div id="compareList" class="compare-list"></div>
    </div>
  </aside>
</div>

<script src="/assets/app.js"></script>
</body>
</html>
